<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[tags: 双网卡 | Billowkiller's Blog]]></title>
  <link href="http://billowkiller.github.io/blog/tags/shuang-wang-qia/atom.xml" rel="self"/>
  <link href="http://billowkiller.github.io/"/>
  <updated>2014-08-26T17:17:41+08:00</updated>
  <id>http://billowkiller.github.io/</id>
  <author>
    <name><![CDATA[wutao]]></name>
    <email><![CDATA[billowkiller@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[linux下双网卡配置]]></title>
    <link href="http://billowkiller.github.io/blog/2013/05/14/linuxxia-shuang-wang-qia-pei-zhi/"/>
    <updated>2013-05-14T01:09:00+08:00</updated>
    <id>http://billowkiller.github.io/blog/2013/05/14/linuxxia-shuang-wang-qia-pei-zhi</id>
    <content type="html"><![CDATA[<p><strong>需求</strong>： 一台PC1拥有双网卡，另外一台PC2需要通过这台pc上网。</p>

<p><img src="http://images.cnblogs.com/cnblogs_com/billowkiller/447098/r_ac345982b2b7d0a207325429cbef76094a369a8e.jpg" alt="网络拓扑图" /></p>

<p><strong>配置过程</strong>：</p>

<p>首先需要配置pc1的两个网卡信息以及pc2的网卡信息。这个比较简单，接下里需要配置pc1中的静态路由。</p>

<p>文件ipt.save表示静态路由表的修改文件。</p>

<pre><code># Generated by iptables-save v1.4.2 on Wed Nov 16 15:04:23 2011
 *filter
 :INPUT ACCEPT [203:29797]
 :FORWARD ACCEPT [0:0]
 :OUTPUT ACCEPT [83:10885]
 COMMIT
 # Completed on Wed Nov 16 15:04:23 2011
 # Generated by iptables-save v1.4.2 on Wed Nov 16 15:04:23 2011
 *nat
 :PREROUTING ACCEPT [82:12935]
 :POSTROUTING ACCEPT [25:1724]
 :OUTPUT ACCEPT [25:1724]
 -A POSTROUTING -s 10.0.0.0/8 ! -d 10.0.0.0/8 -j MASQUERADE 
 COMMIT
 # s-&gt;source !d-&gt;not distination-&gt;not in the same subset
 # Completed on Wed Nov 16 15:04:23 2011
</code></pre>

<p>进入root权限后，执行命令</p>

<pre><code>iptables-restore /home/angel/net_scripts/ipt.save
</code></pre>

<p>这样就是修改了静态路由表，但还需要将转发开关打开，需要命令如下</p>

<pre><code>echo '1' &gt; /proc/sys/net/ipv4/ip_forward
</code></pre>

<p>这样修改之后pc2就可以通过pc1上网了。
<!--more-->
但是重启后发现<strong>两个问题</strong>：</p>

<ul>
  <li>linux下如果有两个网卡eth0和eth1，系统启动时候会先启动eth0，后启动eth1，这样造成eth0的信息被eth1覆盖。</li>
  <li>以上的两个命令并不是永久的，重启后失效。</li>
</ul>

<p>第一个问题的解决方案是修改/etc/network/interfaces
文件，修改网卡接口的信息，修改后的文件如下：</p>

<pre><code># interfaces(5) file used by ifup(8) and ifdown(8)
 auto lo
 iface lo inet loopback
 
 auto eth1
 iface eth1 inet dhcp
 
 auto eth0
 iface eth0 inet static
 address 10.0.0.1
 netmask 255.0.0.0
 broadcast 10.255.255.255
</code></pre>

<p>需要重启生效，也可以使用命令</p>

<pre><code>sudo /etc/init.d/networking restart
</code></pre>

<p>第二个问题可以写一个简单的脚本iptable.sh来实现，每次开机启动自动执行脚本：</p>

<pre><code>iptables-restore /home/angel/net_scripts/ipt.save
 echo '1' &gt; /proc/sys/net/ipv4/ip_forward
</code></pre>

<p>将脚本放在任意的位置，如下放入home文件夹下，修改/etc/rc.local文件：</p>

<pre><code>#!/bin/sh -e
 #
 # rc.local
 #
 # This script is executed at the end of each multiuser runlevel.
 # Make sure that the script will "exit 0" on success or any other
 # value on error.
 #
 # In order to enable or disable this script just change the execution
 # bits.
 #
 # By default this script does nothing.
 sh /home/bk/iptable.sh
 exit 0
</code></pre>

<p>这样每次启动都会调用脚本，并且使用root权限。</p>
]]></content>
  </entry>
  
</feed>
